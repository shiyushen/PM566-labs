<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<style type="text/css">
@font-face {
font-family: octicons-link;
src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}
body {
-webkit-text-size-adjust: 100%;
text-size-adjust: 100%;
color: #333;
font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
font-size: 16px;
line-height: 1.6;
word-wrap: break-word;
}
a {
background-color: transparent;
}
a:active,
a:hover {
outline: 0;
}
strong {
font-weight: bold;
}
h1 {
font-size: 2em;
margin: 0.67em 0;
}
img {
border: 0;
}
hr {
box-sizing: content-box;
height: 0;
}
pre {
overflow: auto;
}
code,
kbd,
pre {
font-family: monospace, monospace;
font-size: 1em;
}
input {
color: inherit;
font: inherit;
margin: 0;
}
html input[disabled] {
cursor: default;
}
input {
line-height: normal;
}
input[type="checkbox"] {
box-sizing: border-box;
padding: 0;
}
table {
border-collapse: collapse;
border-spacing: 0;
}
td,
th {
padding: 0;
}
* {
box-sizing: border-box;
}
input {
font: 13px / 1.4 Helvetica, arial, nimbussansl, liberationsans, freesans, clean, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
}
a {
color: #4078c0;
text-decoration: none;
}
a:hover,
a:active {
text-decoration: underline;
}
hr {
height: 0;
margin: 15px 0;
overflow: hidden;
background: transparent;
border: 0;
border-bottom: 1px solid #ddd;
}
hr:before {
display: table;
content: "";
}
hr:after {
display: table;
clear: both;
content: "";
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 15px;
margin-bottom: 15px;
line-height: 1.1;
}
h1 {
font-size: 30px;
}
h2 {
font-size: 21px;
}
h3 {
font-size: 16px;
}
h4 {
font-size: 14px;
}
h5 {
font-size: 12px;
}
h6 {
font-size: 11px;
}
blockquote {
margin: 0;
}
ul,
ol {
padding: 0;
margin-top: 0;
margin-bottom: 0;
}
ol ol,
ul ol {
list-style-type: lower-roman;
}
ul ul ol,
ul ol ol,
ol ul ol,
ol ol ol {
list-style-type: lower-alpha;
}
dd {
margin-left: 0;
}
code {
font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
font-size: 12px;
}
pre {
margin-top: 0;
margin-bottom: 0;
font: 12px Consolas, "Liberation Mono", Menlo, Courier, monospace;
}
.select::-ms-expand {
opacity: 0;
}
.octicon {
font: normal normal normal 16px/1 octicons-link;
display: inline-block;
text-decoration: none;
text-rendering: auto;
-webkit-font-smoothing: antialiased;
-moz-osx-font-smoothing: grayscale;
-webkit-user-select: none;
-moz-user-select: none;
-ms-user-select: none;
user-select: none;
}
.octicon-link:before {
content: '\f05c';
}
.markdown-body:before {
display: table;
content: "";
}
.markdown-body:after {
display: table;
clear: both;
content: "";
}
.markdown-body>*:first-child {
margin-top: 0 !important;
}
.markdown-body>*:last-child {
margin-bottom: 0 !important;
}
a:not([href]) {
color: inherit;
text-decoration: none;
}
.anchor {
display: inline-block;
padding-right: 2px;
margin-left: -18px;
}
.anchor:focus {
outline: none;
}
h1,
h2,
h3,
h4,
h5,
h6 {
margin-top: 1em;
margin-bottom: 16px;
font-weight: bold;
line-height: 1.4;
}
h1 .octicon-link,
h2 .octicon-link,
h3 .octicon-link,
h4 .octicon-link,
h5 .octicon-link,
h6 .octicon-link {
color: #000;
vertical-align: middle;
visibility: hidden;
}
h1:hover .anchor,
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor,
h5:hover .anchor,
h6:hover .anchor {
text-decoration: none;
}
h1:hover .anchor .octicon-link,
h2:hover .anchor .octicon-link,
h3:hover .anchor .octicon-link,
h4:hover .anchor .octicon-link,
h5:hover .anchor .octicon-link,
h6:hover .anchor .octicon-link {
visibility: visible;
}
h1 {
padding-bottom: 0.3em;
font-size: 2.25em;
line-height: 1.2;
border-bottom: 1px solid #eee;
}
h1 .anchor {
line-height: 1;
}
h2 {
padding-bottom: 0.3em;
font-size: 1.75em;
line-height: 1.225;
border-bottom: 1px solid #eee;
}
h2 .anchor {
line-height: 1;
}
h3 {
font-size: 1.5em;
line-height: 1.43;
}
h3 .anchor {
line-height: 1.2;
}
h4 {
font-size: 1.25em;
}
h4 .anchor {
line-height: 1.2;
}
h5 {
font-size: 1em;
}
h5 .anchor {
line-height: 1.1;
}
h6 {
font-size: 1em;
color: #777;
}
h6 .anchor {
line-height: 1.1;
}
p,
blockquote,
ul,
ol,
dl,
table,
pre {
margin-top: 0;
margin-bottom: 16px;
}
hr {
height: 4px;
padding: 0;
margin: 16px 0;
background-color: #e7e7e7;
border: 0 none;
}
ul,
ol {
padding-left: 2em;
}
ul ul,
ul ol,
ol ol,
ol ul {
margin-top: 0;
margin-bottom: 0;
}
li>p {
margin-top: 16px;
}
dl {
padding: 0;
}
dl dt {
padding: 0;
margin-top: 16px;
font-size: 1em;
font-style: italic;
font-weight: bold;
}
dl dd {
padding: 0 16px;
margin-bottom: 16px;
}
blockquote {
padding: 0 15px;
color: #777;
border-left: 4px solid #ddd;
}
blockquote>:first-child {
margin-top: 0;
}
blockquote>:last-child {
margin-bottom: 0;
}
table {
display: block;
width: 100%;
overflow: auto;
word-break: normal;
word-break: keep-all;
}
table th {
font-weight: bold;
}
table th,
table td {
padding: 6px 13px;
border: 1px solid #ddd;
}
table tr {
background-color: #fff;
border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
background-color: #f8f8f8;
}
img {
max-width: 100%;
box-sizing: content-box;
background-color: #fff;
}
code {
padding: 0;
padding-top: 0.2em;
padding-bottom: 0.2em;
margin: 0;
font-size: 85%;
background-color: rgba(0,0,0,0.04);
border-radius: 3px;
}
code:before,
code:after {
letter-spacing: -0.2em;
content: "\00a0";
}
pre>code {
padding: 0;
margin: 0;
font-size: 100%;
word-break: normal;
white-space: pre;
background: transparent;
border: 0;
}
.highlight {
margin-bottom: 16px;
}
.highlight pre,
pre {
padding: 16px;
overflow: auto;
font-size: 85%;
line-height: 1.45;
background-color: #f7f7f7;
border-radius: 3px;
}
.highlight pre {
margin-bottom: 0;
word-break: normal;
}
pre {
word-wrap: normal;
}
pre code {
display: inline;
max-width: initial;
padding: 0;
margin: 0;
overflow: initial;
line-height: inherit;
word-wrap: normal;
background-color: transparent;
border: 0;
}
pre code:before,
pre code:after {
content: normal;
}
kbd {
display: inline-block;
padding: 3px 5px;
font-size: 11px;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.pl-c {
color: #969896;
}
.pl-c1,
.pl-s .pl-v {
color: #0086b3;
}
.pl-e,
.pl-en {
color: #795da3;
}
.pl-s .pl-s1,
.pl-smi {
color: #333;
}
.pl-ent {
color: #63a35c;
}
.pl-k {
color: #a71d5d;
}
.pl-pds,
.pl-s,
.pl-s .pl-pse .pl-s1,
.pl-sr,
.pl-sr .pl-cce,
.pl-sr .pl-sra,
.pl-sr .pl-sre {
color: #183691;
}
.pl-v {
color: #ed6a43;
}
.pl-id {
color: #b52a1d;
}
.pl-ii {
background-color: #b52a1d;
color: #f8f8f8;
}
.pl-sr .pl-cce {
color: #63a35c;
font-weight: bold;
}
.pl-ml {
color: #693a17;
}
.pl-mh,
.pl-mh .pl-en,
.pl-ms {
color: #1d3e81;
font-weight: bold;
}
.pl-mq {
color: #008080;
}
.pl-mi {
color: #333;
font-style: italic;
}
.pl-mb {
color: #333;
font-weight: bold;
}
.pl-md {
background-color: #ffecec;
color: #bd2c00;
}
.pl-mi1 {
background-color: #eaffea;
color: #55a532;
}
.pl-mdr {
color: #795da3;
font-weight: bold;
}
.pl-mo {
color: #1d3e81;
}
kbd {
display: inline-block;
padding: 3px 5px;
font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
line-height: 10px;
color: #555;
vertical-align: middle;
background-color: #fcfcfc;
border: solid 1px #ccc;
border-bottom-color: #bbb;
border-radius: 3px;
box-shadow: inset 0 -1px 0 #bbb;
}
.task-list-item {
list-style-type: none;
}
.task-list-item+.task-list-item {
margin-top: 3px;
}
.task-list-item input {
margin: 0 0.35em 0.25em -1.6em;
vertical-align: middle;
}
:checked+.radio-label {
z-index: 1;
position: relative;
border-color: #4078c0;
}
.sourceLine {
display: inline-block;
}
code .kw { color: #000000; }
code .dt { color: #ed6a43; }
code .dv { color: #009999; }
code .bn { color: #009999; }
code .fl { color: #009999; }
code .ch { color: #009999; }
code .st { color: #183691; }
code .co { color: #969896; }
code .ot { color: #0086b3; }
code .al { color: #a61717; }
code .fu { color: #63a35c; }
code .er { color: #a61717; background-color: #e3d2d2; }
code .wa { color: #000000; }
code .cn { color: #008080; }
code .sc { color: #008080; }
code .vs { color: #183691; }
code .ss { color: #183691; }
code .im { color: #000000; }
code .va {color: #008080; }
code .cf { color: #000000; }
code .op { color: #000000; }
code .bu { color: #000000; }
code .ex { color: #000000; }
code .pp { color: #999999; }
code .at { color: #008080; }
code .do { color: #969896; }
code .an { color: #008080; }
code .cv { color: #008080; }
code .in { color: #008080; }
</style>
<style>
body {
  box-sizing: border-box;
  min-width: 200px;
  max-width: 980px;
  margin: 0 auto;
  padding: 45px;
  padding-top: 0px;
}
</style>

</head>

<body>

<h1 id="lab-9---hpc">Lab 9 - HPC</h1>
<h1 id="learning-goals">Learning goals</h1>
<p>In this lab, you are expected to learn/put in practice the following skills:</p>
<ul>
<li>Evaluate whether a problem can be parallelized or not.</li>
<li>Practice with the parallel package.</li>
<li>Use Rscript to submit jobs</li>
<li>Practice your skills with Git.</li>
</ul>
<h2 id="problem-1-think">Problem 1: Think</h2>
<p>Give yourself a few minutes to think about what you just learned. List three examples of problems that you believe may be solved using parallel computing, and check for packages on the HPC CRAN task view that may be related to it.</p>
<ul>
<li>Cross-validation in machine learning. ‘carat’, ‘mlr’.</li>
<li>Bootstrapping: ‘boot’.</li>
<li>Monte Carlo simulation: ‘parallel’.</li>
<li>Agent Based Modeling: ‘parallel’.</li>
</ul>
<h2 id="problem-2-before-you">Problem 2: Before you</h2>
<p>The following functions can be written to be more efficient without using parallel:</p>
<ol>
<li>This function generates a <code>n x k</code> dataset with all its entries distributed poission with mean <code>lambda</code>.</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true"></a>fun1 &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">4</span>) {</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true"></a>  x &lt;-<span class="st"> </span><span class="ot">NULL</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>n)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true"></a>    x &lt;-<span class="st"> </span><span class="kw">rbind</span>(x, <span class="kw">rpois</span>(k, lambda))</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true"></a>  x</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true"></a>}</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true"></a>fun1alt &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">k =</span> <span class="dv">4</span>, <span class="dt">lambda =</span> <span class="dv">4</span>) {</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true"></a>  <span class="kw">matrix</span>(<span class="kw">rpois</span>(n<span class="op">*</span>k,<span class="dt">lambda =</span> lambda),<span class="dt">ncol =</span> k)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true"></a>}</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true"></a><span class="co"># Benchmarking</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true"></a>microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true"></a>  <span class="kw">fun1</span>(<span class="dv">100</span>),</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true"></a>  <span class="kw">fun1alt</span>(<span class="dv">100</span>), <span class="dt">unit=</span><span class="st">&quot;relative&quot;</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Unit: relative
##          expr      min       lq     mean   median       uq      max neval
##     fun1(100) 18.17684 22.27889 17.20453 22.96567 22.38828 10.98426   100
##  fun1alt(100)  1.00000  1.00000  1.00000  1.00000  1.00000  1.00000   100
</code></pre>
<ol start="2">
<li>Find the column max (hint: Checkout the function <code>max.col()</code>).</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true"></a><span class="co"># Data Generating Process (10 x 10,000 matrix)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="fl">1e4</span>), <span class="dt">nrow=</span><span class="dv">10</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true"></a><span class="co"># Find each column&#39;s max value</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true"></a>fun2 &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true"></a>  <span class="kw">apply</span>(x, <span class="dv">2</span>, max)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true"></a>}</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true"></a>fun2alt &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true"></a>  x[<span class="kw">cbind</span>(<span class="kw">max.col</span>(<span class="kw">t</span>(x)),<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(x))]</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true"></a>}</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true"></a><span class="co"># Benchmarking</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true"></a>microbenchmark<span class="op">::</span><span class="kw">microbenchmark</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true"></a>  <span class="kw">fun2</span>(x),</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true"></a>  <span class="kw">fun2alt</span>(x), <span class="dt">unit=</span><span class="st">&quot;relative&quot;</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true"></a>)</span></code></pre></div>
<pre><code>## Unit: relative
##        expr      min       lq     mean  median       uq      max neval
##     fun2(x) 9.576869 7.890458 7.253113 7.88351 7.913617 1.264588   100
##  fun2alt(x) 1.000000 1.000000 1.000000 1.00000 1.000000 1.000000   100
</code></pre>
<h2 id="problem-3-parallelize-everyhing">Problem 3: Parallelize everyhing</h2>
<p>We will now turn our attention to non-parametric <a href="https://en.wikipedia.org/wiki/Bootstrapping_(statistics)">bootstrapping</a>. Among its many uses, non-parametric bootstrapping allow us to obtain confidence intervals for parameter estimates without relying on parametric assumptions.</p>
<p>The main assumption is that we can approximate many experiments by resampling observations from our original dataset, which reflects the population.</p>
<p>This function implements the non-parametric bootstrap:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true"></a><span class="kw">library</span>(parallel)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true"></a>my_boot &lt;-<span class="st"> </span><span class="cf">function</span>(dat, stat, R, <span class="dt">ncpus =</span> 1L) {</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true"></a>  </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true"></a>  <span class="co"># Getting the random indices</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true"></a>  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(dat)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true"></a>  idx &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">sample.int</span>(n, n<span class="op">*</span>R, <span class="ot">TRUE</span>), <span class="dt">nrow=</span>n, <span class="dt">ncol=</span>R)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true"></a> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true"></a>  <span class="co"># Making the cluster using `ncpus`</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true"></a>  cl&lt;-<span class="kw">makePSOCKcluster</span>(ncpus)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true"></a>  <span class="kw">clusterExport</span>(cl, <span class="dt">varlist =</span> <span class="kw">c</span>(<span class="st">&quot;idx&quot;</span>,<span class="st">&quot;dat&quot;</span>,<span class="st">&quot;stat&quot;</span>), <span class="dt">envir =</span> <span class="kw">environment</span>())</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true"></a></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true"></a>  </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true"></a>    <span class="co"># STEP 3: THIS FUNCTION NEEDS TO BE REPLACES WITH parLapply</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true"></a>  ans &lt;-<span class="st"> </span><span class="kw">parLapply</span>(cl, <span class="kw">seq_len</span>(R), <span class="cf">function</span>(i) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true"></a>    <span class="kw">stat</span>(dat[idx[,i], , <span class="dt">drop=</span><span class="ot">FALSE</span>])</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true"></a>  })</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true"></a>  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true"></a>  <span class="co"># Coercing the list into a matrix</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true"></a>  ans &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, ans)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true"></a>  </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true"></a>  <span class="co"># STEP 4: GOES HERE</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true"></a>  <span class="kw">stopCluster</span>(cl)</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true"></a>  ans</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true"></a>  </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true"></a>}</span></code></pre></div>
<ol>
<li>Use the previous pseudocode, and make it work with parallel. Here is just an example for you to try:</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true"></a><span class="co"># Bootstrap of an OLS</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true"></a>my_stat &lt;-<span class="st"> </span><span class="cf">function</span>(d) <span class="kw">coef</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data=</span>d))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true"></a><span class="co"># DATA SIM</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true"></a><span class="kw">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true"></a>n &lt;-<span class="st"> </span><span class="dv">500</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true"></a>R &lt;-<span class="st"> </span><span class="dv">1000</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true"></a>x &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">rnorm</span>(n))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true"></a>y &lt;-<span class="st"> </span>x<span class="op">*</span><span class="dv">5</span> <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(n)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true"></a><span class="co"># Checking if we get something similar as lm</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true"></a>ans0 &lt;-<span class="st"> </span><span class="kw">confint</span>(<span class="kw">lm</span>(y<span class="op">~</span>x))</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true"></a>ans1 &lt;-<span class="st"> </span><span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> R, <span class="dt">ncpus =</span> 2L)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true"></a></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true"></a><span class="co"># You should get something like this</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true"></a><span class="kw">t</span>(<span class="kw">apply</span>(ans1, <span class="dv">2</span>, quantile, <span class="kw">c</span>(.<span class="dv">025</span>,.<span class="dv">975</span>)))</span></code></pre></div>
<pre><code>##                   2.5%      97.5%
## (Intercept) -0.1430703 0.05292241
## x            4.8685251 5.04843669
</code></pre>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true"></a><span class="co">##                   2.5%      97.5%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true"></a><span class="co">## (Intercept) -0.1372435 0.05074397</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true"></a><span class="co">## x            4.8680977 5.04539763</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true"></a>ans0</span></code></pre></div>
<pre><code>##                  2.5 %     97.5 %
## (Intercept) -0.1379033 0.04797344
## x            4.8650100 5.04883353
</code></pre>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true"></a><span class="co">##                  2.5 %     97.5 %</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true"></a><span class="co">## (Intercept) -0.1379033 0.04797344</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true"></a><span class="co">## x            4.8650100 5.04883353</span></span></code></pre></div>
<ol start="2">
<li>Check whether your version actually goes faster than the non-parallel version:</li>
</ol>
<!-- end list -->

<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true"></a><span class="kw">system.time</span>(<span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> <span class="dv">3000</span>, <span class="dt">ncpus =</span> 1L))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.061   0.009   2.503
</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true"></a><span class="kw">system.time</span>(<span class="kw">my_boot</span>(<span class="dt">dat =</span> <span class="kw">data.frame</span>(x, y), my_stat, <span class="dt">R =</span> <span class="dv">3000</span>, <span class="dt">ncpus =</span> 4L))</span></code></pre></div>
<pre><code>##    user  system elapsed 
##   0.146   0.020   1.236
</code></pre>
<h2 id="problem-4-compile-this-markdown-document-using-rscript">Problem 4: Compile this markdown document using Rscript</h2>
<p>Once you have saved this Rmd file, try running the following command in your terminal:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true"></a><span class="ex">Rscript</span> --vanilla -e <span class="st">&#39;rmarkdown::render(&quot;[full-path-to-your-Rmd-file.Rmd]&quot;)&#39;</span> <span class="kw">&amp;</span></span></code></pre></div>
<p>Where <code>[full-path-to-your-Rmd-file.Rmd]</code> should be replace with the full path to your Rmd file… :).</p>

</body>
</html>
